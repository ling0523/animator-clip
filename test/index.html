<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>animator</title>
		<meta name="viewport"
			content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/mvi-web/lib/mvi.css" />
		<script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script>
		<script src="https://cdn.jsdelivr.net/npm/mvi-web/lib/mvi.umd.min.js" type="text/javascript" charset="utf-8">
		</script>
		<script src="../dist/animator-clip.js" type="text/javascript" charset="utf-8"></script>
		<script src="https://cdn.bootcdn.net/ajax/libs/vConsole/3.3.4/vconsole.min.js"></script>
		<script>
			new VConsole();
		</script>
		<style type="text/css">
			[v-cloak] {
				display: none;
			}

			html {
				font-size: 50px;
			}

			#app {
				display: block;
				width: 100%;
				height: 100%;
				overflow: hidden;
			}

			#el {
				width: 1rem;
				height:1rem;
				position: absolute;
				left: 0;
				top: 0;
			}

			#area {
				width: 100%;
				height: 5rem;
				position: relative;
			}
			
			.records{
				display: block;
				width: 100%;
				padding: .2rem;
				height: calc(100% - 7.6rem);
				border: 0.1rem solid #ccc;
				overflow: auto;
			}
		</style>
	</head>
	<body>
		<div id="app" v-cloak>
			<fieldset class="mvi-mb-2">
				<legend>动画区域</legend>
				<div id="area" ref="area">
					<div id="el" class="mvi-radius-round mvi-bg-primary" ref="el"></div>
				</div>
			</fieldset>
			<div class="mvi-mb-4">
				<m-button class="mvi-m-2" @click="goRight">向右移动</m-button>
				<m-button class="mvi-m-2" @click="goBottom">向下移动</m-button>
				<m-button class="mvi-m-2" @click="opacityChange">透明度变化</m-button>
				<m-button class="mvi-m-2" @click="chain">多个动画链式执行</m-button>
				<m-button class="mvi-m-2" @click="same">多个动画同时执行</m-button>
				<m-button class="mvi-m-2" @click="scale">放大和缩小</m-button>
				<m-button class="mvi-m-2" @click="radius">圆角变化</m-button>
			</div>
			<div class="records">
				<div v-for="(item,index) in records" :key="'record-'+index">{{item}}</div>
			</div>
		</div>
	</body>
	
	<script>
		const {
			Animator,
			Clip
		} = AnimatorClip
		new Vue({
			el: '#app',
			data: {
				//动画实例
				animator: null,
				//动画输出记录
				records:[]
			},
			mounted() {
				this.animator = new Animator('#el',{
					start:(clip,el)=>{
						this.records.push(`动画开始【属性：${clip.style}，单位：${clip.$unit?clip.$unit:'无单位'}，速度：${clip.speed}，初始值：${clip.$initValue}，终点值：${clip.value}${clip.$unit?clip.$unit:''}】`);
					},
					complete:(clip,el)=>{
						this.records.push(`动画完成【属性：${clip.style}，单位：${clip.$unit?clip.$unit:'无单位'}，速度：${clip.speed}，初始值：${clip.$initValue}，终点值：${clip.value}${clip.$unit?clip.$unit:''}】`);
					},
					beforeUpdate:(clip,el,style,value)=>{
						console.log('动画帧更新之前触发')
					},
					update:(clip,el,style,value)=>{
						if(style){
							this.records.push(`动画帧更新【属性：${style}，单位：${clip.$unit?clip.$unit:'无单位'}，速度：${clip.speed}，初始值：${clip.$initValue}，终点值：${clip.value}${clip.$unit?clip.$unit:''}，当前值：${Number(value.toFixed(2))}${clip.$unit?clip.$unit:''}】`);
						}
					}
				});
			},
			methods: {
				//圆角变化
				radius(){
					this.records = [];
					const clip = new Clip({
						style: 'border-top-left-radius',
						value: '0rem',
						speed: -10
					})
					const clip2 = new Clip({
						style: 'border-top-right-radius',
						value: '0rem',
						speed: -10
					})
					const clip3 = new Clip({
						style: 'border-bottom-right-radius',
						value: '0rem',
						speed: -10
					})
					this.animator.reset().removeAllClips().addClip(clip).addClip(clip2).addClip(clip3).start()
				},
				//放大和缩小
				scale(){
					this.records = [];
					let scale = 1
					const clip = new Clip()
					const clip2 = new Clip()
					clip.on('update',(el,style,value)=>{
						if(scale>0){
							scale -= 0.02;
						    el.style.transform = 'scale('+scale+')';
						}else {
						    clip.emitComplete();
						}
					}).on('reset',el=>{
						scale = 1;
						el.style.transform = 'scale('+scale+')';
					})
					
					clip2.on('update',(el,style,value)=>{
						if(scale<1){
							scale += 0.02;
						    el.style.transform = 'scale('+scale+')';
						}else {
						    clip2.emitComplete();
						}
					}).on('reset',el=>{
						scale = 1;
						el.style.transform = 'scale('+scale+')';
					})
					clip.chain(clip2)
					this.animator.removeAllClips().addClip(clip).start()
				},
				//透明度变化
				opacityChange(){
					this.records = [];
					const clip = new Clip({
						style: 'opacity',
						value: 0,
						speed: -0.01
					})
					this.animator.reset().removeAllClips().addClip(clip).start()
				},
				//多个动画同时执行
				same(){
					this.records = [];
					const clip = new Clip({
						style: 'top',
						value: (this.$refs.area.offsetHeight - this.$refs.el.offsetHeight) + 'px',
						speed: 3
					})
					const clip2 = new Clip({
						style: 'left',
						value: (this.$refs.area.offsetWidth - this.$refs.el.offsetWidth) + 'px',
						speed: 10
					})
					const clip3 = new Clip({
						style: 'opacity',
						value: 0,
						speed: -0.01
					})
					this.animator.reset().removeAllClips().addClip(clip).addClip(clip2).addClip(clip3).start()
				},
				//多个动画链式执行
				chain(){
					this.records = [];
					const clip = new Clip({
						style: 'top',
						value: (this.$refs.area.offsetHeight - this.$refs.el.offsetHeight) + 'px',
						speed: 3
					})
					const clip2 = new Clip({
						style: 'left',
						value: (this.$refs.area.offsetWidth - this.$refs.el.offsetWidth) + 'px',
						speed: 10
					})
					const clip3 = new Clip({
						style: 'opacity',
						value: 0,
						speed: -0.01
					})
					clip.chain(clip2).chain(clip3)
					this.animator.reset().removeAllClips().addClip(clip).start()
				},
				//向右移动
				goRight() {
					this.records = [];
					const clip = new Clip({
						style: 'left',
						value: (this.$refs.area.offsetWidth - this.$refs.el.offsetWidth) + 'px',
						speed: 10
					})
					clip.on('beforeUpdate',(el,style,value)=>{
						console.log(style,value)
					})
					this.animator.reset().removeAllClips().addClip(clip).start()
				},
				//向下移动
				goBottom(){
					this.records = [];
					const clip = new Clip({
						style: 'top',
						value: (this.$refs.area.offsetHeight - this.$refs.el.offsetHeight) + 'px',
						speed: 3
					})
					this.animator.reset().removeAllClips().addClip(clip).start()
				}
			}
		})
	</script>
</html>
